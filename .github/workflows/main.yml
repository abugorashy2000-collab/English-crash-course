
    name: Build Kivy APK

    on: [push]

    jobs:
      build:
        runs-on: ubuntu-latest

        steps:

        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: '3.9' # Or your desired Python version
        - name: Install Cython
          run: pip install cython
        - name: Install dependencies
          run: |
            sudo apt-get update
            sudo apt-get install -y libtinfo6
            sudo ln -s /usr/lib/x86_64-linux-gnu/libtinfo.so.6 /usr/lib/x86_64-linux-gnu/libtinfo.so.5
    
         

        - name: Install Buildozer and dependencies
          run: |
            sudo apt-get update
            sudo apt-get install -y git zip unzip openjdk-17-jdk autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libssl-dev build-essential patch libffi-dev python3-dev python3-pip
                            pip install buildozer
        - name: Create build-tools directory
          run: mkdir -p /home/runner/android-sdk/build-tools
        - name: Install Android Build Tools
          run: |
            sudo apt-get update
            sudo apt-get install -y wget unzip
            wget https://dl.google.com/android/repository/build-tools_r33.0.2-linux.zip
            unzip build-tools_r33.0.2-linux.zip -d $HOME/android-sdk/build-tools
            export PATH=$HOME/android-sdk/build-tools/33.0.0:$PATH
        - name: Set up working directory
          run: cd ${{ github.workspace }}



            
        - name: Generate buildozer.spec if missing
          run: |
           if [ ! -f buildozer.spec ]; then
           buildozer init
           fi
        - name: Set up working directory
          run: cd ${{ github.workspace }}
        - name: Install Android SDK Command-line Tools
          run: |
           sudo apt-get update
           sudo apt-get install -y wget unzip
           wget https://dl.google.com/android/repository/commandlinetools-linux-10406996_latest.zip -O cmdline-tools.zip
           mkdir -p $HOME/android/cmdline-tools
           unzip cmdline-tools.zip -d $HOME/android/cmdline-tools
           export ANDROID_SDK_ROOT=$HOME/android
           export PATH=$ANDROID_SDK_ROOT/cmdline-tools/cmdline-tools/bin:$PATH
           echo "ANDROID_SDK_ROOT=$ANDROID_SDK_ROOT" >> $GITHUB_ENV
           echo "PATH=$PATH" >> $GITHUB_ENV



        - name: Install Android SDK Command-line Tools
          run: |
           mkdir -p $ANDROID_HOME/cmdline-tools
           cd $ANDROID_HOME/cmdline-tools
           wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -O cmdline-tools.zip
           unzip cmdline-tools.zip
           mv cmdline-tools latest

        - name: Set up PATH for sdkmanager
          run: echo "$ANDROID_HOME/cmdline-tools/latest/bin" >> $GITHUB_PATH


         # last cmmand below

        - name: Unzip? [y]es, [n]o, [A]ll, [N]one, [r]ename:â€). The command line tools
          run: unzip -o commandlinetools.zip
      

    #-----------
          

        - name: Unzip commandline tools
          run: unzip -o commandlinetools.zip -d $ANDROID_HOME



  
        - name: Set up Android SDK
          run: |
           mkdir -p $ANDROID_HOME/cmdline-tools
           cd $ANDROID_HOME/cmdline-tools
           curl -o commandlinetools.zip https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip
           unzip commandlinetools.zip -d latest
           yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --licenses

        

        - name: Install Android SDK Build Tools
          run: |
           sdkmanager "build-tools;33.0.0"  # Use the required version for your project
           sdkmanager --install "platform-tools"
           sdkmanager --install "platforms;android-33"

        - name: Set ANDROID_HOME
          run: echo "ANDROID_HOME=$HOME/android-sdk" >> $GITHUB_ENV
        - name: Install Android Build Tools
          run: |
           yes | $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager --install "build-tools;34.0.0"











        











          
        - name: Build with Buildozer
          run: buildozer android debug
         
          

        
       

